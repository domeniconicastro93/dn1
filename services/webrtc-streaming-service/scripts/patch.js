const fs=require("fs");let s=fs.readFileSync(__dirname+"/../src/webrtc-peer.ts","utf8");s=s.replace(/import.*capture-provider.*;?\s*\n?/g,"");if(!s.includes("native_capture")){const i=s.lastIndexOf("import ");s=s.slice(0,s.indexOf("\n",i)+1)+"const nativeCapture=require(\"../../native_capture.node\");\n"+s.slice(s.indexOf("\n",i)+1)}s=s.replace(/private captureProvider.*/g,"");s=s.replace(/FFmpeg/g,"Native WGC");function r(t,m,b){const i=t.indexOf(m+"("),x=t.indexOf("{",i);let d=0,j=x;for(;j<t.length;j++){if(t[j]==="{")d++;else if(t[j]==="}"){d--;if(!d){j++;break}}}return t.slice(0,t.lastIndexOf("\n",i)+1)+b+"\n"+t.slice(j)}s=r(s,"startCapture","private startCapture():void{\n  console.log(`[WebRTCPeer][${this.sessionId}] Starting native capture`);\n  nativeCapture.start({width:this.streamConfig.width,height:this.streamConfig.height,fps:this.streamConfig.fps,bitrate:this.streamConfig.bitrate??5000,useHardwareEncoder:false},(nalBuffer)=>{this.processH264Data(nalBuffer);});\n  console.log(`[WebRTCPeer][${this.sessionId}] Native capture started`);\n}");s=r(s,"stopCapture","private stopCapture():void{\n  if(nativeCapture?.stop)nativeCapture.stop();\n  this.h264Parser.clear();\n  console.log(`[WebRTCPeer][${this.sessionId}] Native capture stopped`);\n}");fs.writeFileSync(__dirname+"/../src/webrtc-peer.ts",s);console.log("PATCH_OK");
